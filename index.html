<!-- blockzie-vr/index.html -->
<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Blockzie AR/VR Demo</title>

    <!-- Libraries -->
    <script src="https://unpkg.com/blockly/blockly.min.js"></script>
    <script src="https://unpkg.com/blockly/blocks_compressed.js"></script>
    <script src="https://unpkg.com/blockly/javascript_compressed.js"></script>
    <!-- Import Map for Three.js -->
    <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.158.0/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@0.158.0/examples/jsm/"
      }
    }
  </script>

    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            display: flex;
            flex-direction: column;
            height: 100vh;
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            overflow: hidden;
            background: #0d1b2a;
        }

        /* â”€â”€ Top Header Bar â”€â”€ */
        #header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #0d1b2a;
            padding: 0 20px;
            height: 52px;
            flex-shrink: 0;
            border-bottom: 1px solid #1e2d3e;
        }

        #logo {
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
            font-size: 20px;
            font-weight: 700;
            letter-spacing: 0.3px;
        }

        #logo-icon {
            width: 34px;
            height: 34px;
            background: #FF8C00;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        #logo span.vr-highlight {
            color: #FF8C00;
        }

        #coding-playground-btn {
            padding: 7px 18px;
            font-size: 13px;
            font-weight: 700;
            letter-spacing: 0.5px;
            background: transparent;
            color: white;
            border: 2px solid white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
        }

        #coding-playground-btn:hover {
            background: white;
            color: #0d1b2a;
        }

        /* â”€â”€ Main content area (below header) â”€â”€ */
        #main {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* â”€â”€ Left panel: Block Editor â”€â”€ */
        #left-panel {
            width: 40%;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #1e2d3e;
            background: #f5f5f5;
        }

        .panel-header {
            background: #0d1b2a;
            color: white;
            font-size: 13px;
            font-weight: 700;
            letter-spacing: 1px;
            padding: 8px 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
        }

        .panel-header .dot {
            width: 9px;
            height: 9px;
            border-radius: 50%;
            background: #FF8C00;
            display: inline-block;
        }

        #blocklyDiv {
            flex: 1;
            overflow: hidden;
        }

        /* â”€â”€ Right panel: 3D Scene + Console â”€â”€ */
        #right-panel {
            width: 60%;
            display: flex;
            flex-direction: column;
            background: #0d1b2a;
        }

        /* â”€â”€ Scene toolbar â”€â”€ */
        #scene-toolbar {
            background: #0d1b2a;
            padding: 8px 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
            border-bottom: 1px solid #1e2d3e;
        }

        #scene-panel-header {
            background: #0d1b2a;
            color: white;
            font-size: 13px;
            font-weight: 700;
            letter-spacing: 1px;
            padding: 8px 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
            border-bottom: 1px solid #1e2d3e;
        }

        /* â”€â”€ Toolbar buttons â”€â”€ */
        .tb-btn {
            padding: 7px 14px;
            font-size: 13px;
            font-weight: 600;
            border: 2px solid #ccc;
            border-radius: 6px;
            cursor: pointer;
            background: white;
            color: #222;
            transition: all 0.15s ease;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .tb-btn:hover {
            background: #f0f0f0;
        }

        #stop-btn {
            border-color: #aaa;
        }

        #reset-btn {
            border-color: #aaa;
        }

        #enter-vr-btn {
            background: #FF8C00;
            color: white;
            border-color: #FF8C00;
        }

        #enter-vr-btn:hover {
            background: #e07a00;
            border-color: #e07a00;
        }

        #left-bumper-btn,
        #right-bumper-btn {
            border-color: #aaa;
        }

        #left-bumper-btn.pressed,
        #right-bumper-btn.pressed {
            background: #ddd;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
        }

        #run-btn {
            margin-left: auto;
            padding: 7px 18px;
            font-size: 14px;
            font-weight: 700;
            background: #FF8C00;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        #run-btn:hover {
            background: #e07a00;
        }

        /* â”€â”€ 3D Scene â”€â”€ */
        #scene {
            flex: 1;
            position: relative;
            background: #d0dce8;
            overflow: hidden;
        }

        /* Enter VR (Simulated) overlay button in scene */
        #enter-vr-simulated-btn {
            position: absolute;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            background: #0d1b2a;
            color: white;
            border: 2px solid #FF8C00;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s ease;
            z-index: 10;
        }

        #enter-vr-simulated-btn:hover {
            background: #1a2d40;
        }

        /* â”€â”€ Console â”€â”€ */
        #console-section {
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            height: 130px;
            border-top: 1px solid #1e2d3e;
        }

        #console-panel-header {
            background: #0d1b2a;
            color: white;
            font-size: 13px;
            font-weight: 700;
            letter-spacing: 1px;
            padding: 8px 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
        }

        #console-output {
            flex: 1;
            padding: 10px 14px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
            background: #111c28;
            color: #c8d8e8;
        }

        .console-row {
            margin-bottom: 3px;
            word-wrap: break-word;
        }

        #console-output::-webkit-scrollbar {
            width: 6px;
        }

        #console-output::-webkit-scrollbar-track {
            background: #0d1b2a;
        }

        #console-output::-webkit-scrollbar-thumb {
            background: #2e4a63;
            border-radius: 4px;
        }

        /* Blockly overrides */
        .blocklyMainBackground {
            fill: #ffffff !important;
        }

        .blocklyToolboxDiv {
            background-color: #e8e8e8 !important;
            border-right: 1px solid #ccc !important;
        }

        .blocklyFlyoutBackground {
            fill: #ffffff !important;
            fill-opacity: 1 !important;
        }

        .blocklyTreeRow {
            padding: 10px 8px !important;
            line-height: 22px !important;
        }

        .blocklyTreeLabel {
            font-size: 14px !important;
            font-weight: 500 !important;
        }
    </style>
</head>

<body>

    <!-- Top Header -->
    <div id="header">
        <div id="logo">
            <div id="logo-icon">ðŸŸ§</div>
            Blockzie <span class="vr-highlight">VR</span> Lab
        </div>
        <button id="coding-playground-btn" onclick="">CODING PLAYGROUND</button>
    </div>

    <!-- Main layout -->
    <div id="main">

        <!-- Left: Block Editor -->
        <div id="left-panel">
            <div class="panel-header">
                <span class="dot"></span> BLOCK EDITOR
            </div>
            <div id="blocklyDiv"></div>
        </div>

        <!-- Right: 3D Scene + Console -->
        <div id="right-panel">

            <!-- Scene header with toolbar -->
            <div id="scene-panel-header">
                <span class="dot"></span> 3D SCENE

                <!-- Toolbar buttons inline with header -->
                <div style="display:flex; align-items:center; gap:8px; margin-left: 16px; flex:1;">
                    <button id="stop-btn" class="tb-btn" onclick="stopCode()">â–  Stop</button>
                    <button id="reset-btn" class="tb-btn" onclick="resetRobot()">â†º Reset</button>
                    <button id="enter-vr-btn" class="tb-btn" onclick="enterVR()">ðŸ¥½ Enter VR</button>
                    <button id="left-bumper-btn" class="tb-btn"
                        onmousedown="pressBumper('left')" onmouseup="releaseBumper('left')"
                        ontouchstart="pressBumper('left')" ontouchend="releaseBumper('left')">â—€ Left Bumper</button>
                    <button id="right-bumper-btn" class="tb-btn"
                        onmousedown="pressBumper('right')" onmouseup="releaseBumper('right')"
                        ontouchstart="pressBumper('right')" ontouchend="releaseBumper('right')">â–¶ Right Bumper</button>
                    <button id="run-btn" onclick="runCode()">â–¶ Run Code</button>
                </div>
            </div>

            <!-- 3D Scene canvas -->
            <div id="scene">
                <!-- Desktop VR simulation button inside scene -->
                <button id="enter-vr-simulated-btn" onclick="enterVRSimulated()">
                    ðŸ¥½ Enter VR (Simulated)
                </button>
            </div>

            <!-- Console -->
            <div id="console-section">
                <div id="console-panel-header">
                    <span class="dot"></span> CONSOLE
                </div>
                <div id="console-output"></div>
            </div>

        </div>
    </div>

    <!-- Toolbox -->
    <xml id="toolbox" style="display: none">
        <category name="Events" colour="#FFD500">
            <block type="when_run"></block>
        </category>

        <category name="Drivetrain" colour="#7EC4E8">
            <category name="Actions" colour="#7EC4E8">
                <block type="drive"></block>
                <block type="drive_for"></block>
                <block type="turn"></block>
                <block type="turn_for"></block>
                <block type="turn_to_heading"></block>
                <block type="turn_to_rotation"></block>
                <block type="stop_driving"></block>
            </category>
            <category name="Settings" colour="#7EC4E8">
                <block type="set_drive_velocity"></block>
                <block type="set_turn_velocity"></block>
                <block type="set_drive_heading"></block>
                <block type="set_drive_rotation"></block>
                <block type="set_drive_timeout"></block>
            </category>
            <category name="Values" colour="#7EC4E8">
                <block type="drive_is_done"></block>
                <block type="drive_is_moving"></block>
                <block type="drive_heading"></block>
                <block type="drive_rotation"></block>
            </category>
        </category>

        <category name="Magnet" colour="#A589CF">
            <block type="energize_magnet"></block>
        </category>

        <category name="Drawing" colour="#C77EB5">
            <block type="move_pen"></block>
            <block type="set_pen_to_width"></block>
            <block type="set_pen_to_color"></block>
            <block type="set_pen_color"></block>
            <block type="fill_area"></block>
        </category>

        <category name="Sensing" colour="#5CB1A6">
            <label text="Bumper"></label>
            <block type="bumper_pressed"></block>
            <block type="when_bumper"></block>
            <label text="Distance"></label>
            <block type="distance_found_object"></block>
            <block type="object_distance"></block>
            <label text="Eye"></label>
            <block type="eye_near_object"></block>
            <block type="eye_detects_color"></block>
            <block type="eye_brightness"></block>
            <block type="when_eye"></block>
            <label text="Location"></label>
            <block type="position"></block>
            <block type="position_angle"></block>
        </category>

        <category name="Console" colour="#A5D6A7">
            <block type="print">
                <value name="VALUE">
                    <shadow type="text">
                        <field name="TEXT">Hello, Robot!</field>
                    </shadow>
                </value>
            </block>
            <block type="set_cursor_to_next_row"></block>
            <block type="clear_all_rows"></block>
            <block type="set_print_precision"></block>
            <block type="set_print_color"></block>
        </category>

        <category name="Logic" colour="#FFAB19">
            <category name="Control" colour="#FFAB19">
                <block type="wait"></block>
                <block type="wait_until"></block>
                <block type="repeat"></block>
                <block type="forever"></block>
                <block type="repeat_until"></block>
                <block type="while"></block>
                <block type="controls_if"></block>
                <block type="controls_if_else"></block>
                <block type="break"></block>
                <block type="stop_project"></block>
            </category>
            <category name="Timer" colour="#4C97FF">
                <block type="reset_timer"></block>
                <block type="timer_in_seconds"></block>
                <block type="when_timer"></block>
            </category>
            <category name="Events" colour="#FFD500">
                <block type="when_i_receive"></block>
                <block type="broadcast"></block>
                <block type="broadcast_and_wait"></block>
            </category>
            <category name="Operators" colour="#40BF4A">
                <block type="math_number"></block>
                <block type="text"></block>
                <block type="math_operator">
                    <value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow></value>
                    <value name="B"><shadow type="math_number"><field name="NUM">0</field></shadow></value>
                </block>
                <block type="comparison_operator">
                    <value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow></value>
                    <value name="B"><shadow type="math_number"><field name="NUM">50</field></shadow></value>
                </block>
                <block type="logical_operator"></block>
                <block type="not_operator"></block>
                <block type="range_operator"></block>
                <block type="pick_random"></block>
                <block type="round_number"></block>
                <block type="math_functions"></block>
                <block type="atan2"></block>
                <block type="remainder"></block>
                <block type="join">
                    <value name="A"><shadow type="text"><field name="TEXT">apple</field></shadow></value>
                    <value name="B"><shadow type="text"><field name="TEXT">banana</field></shadow></value>
                </block>
                <block type="letter"></block>
                <block type="length"></block>
                <block type="contains"></block>
                <block type="convert"></block>
            </category>
        </category>

        <category name="Variables" colour="#FF8C1A" custom="VARIABLE"></category>
        <category name="My Blocks" colour="#5CA6DB" custom="PROCEDURE"></category>

        <category name="Comments" colour="#FFFFCC">
            <label text="Add notes to your code"></label>
            <block type="comment"></block>
        </category>

        <category name="Legacy Movement" colour="#5CB1D6">
            <block type="move_forward"></block>
            <block type="turn_left"></block>
            <block type="turn_right"></block>
        </category>

        <category name="Control" colour="#FFAB19">
            <block type="controls_repeat_ext">
                <value name="TIMES">
                    <shadow type="math_number"><field name="NUM">4</field></shadow>
                </value>
            </block>
        </category>
    </xml>

    <!-- Logic Scripts -->
    <script src="./src/blockly/blocks.js"></script>
    <script src="./src/blockly/generator.js"></script>

    <!-- Shim for functions called by buttons (enter/exit VR) -->
    <script>
        // enterVRSimulated is the desktop VR mode (simulated, no headset)
        function enterVRSimulated() {
            if (typeof enterVR === 'function') enterVR({ simulated: true });
        }
        // enterVR (toolbar button) triggers headset VR
        // exitVR shim in case it's called before main.js loads
        window.exitVR = window.exitVR || function() {};
        window.pressBumper = window.pressBumper || function() {};
        window.releaseBumper = window.releaseBumper || function() {};
        window.runCode = window.runCode || function() {};
        window.stopCode = window.stopCode || function() {};
        window.resetRobot = window.resetRobot || function() {};
        window.enterVR = window.enterVR || function() {};
    </script>

    <!-- Main Module -->
    <script type="module" src="./src/main.js"></script>
</body>

</html>